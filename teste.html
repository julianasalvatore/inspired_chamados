<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Abertura de Chamado - Suporte TI</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
    font-family: Arial, sans-serif;
    background: #f2f4f7;
    padding: 20px;
}
.container {
    max-width: 900px;
    background: #fff;
    padding: 25px;
    margin: auto;
    border-radius: 8px;
}
h2 { text-align: center; }
label { font-weight: bold; margin-top: 15px; display: block; }
select, textarea, input, button {
    width: 100%;
    padding: 10px;
    margin-top: 5px;
}
textarea { resize: vertical; }
button {
    background: #0d6efd;
    color: #fff;
    border: none;
    cursor: pointer;
    margin-top: 20px;
}
button:hover { background: #084298; }
.review {
    display: none;
    background: #eef1f5;
    padding: 15px;
    border-radius: 6px;
    margin-top: 20px;
}
pre { white-space: pre-wrap; }
</style>
</head>

<body>
<div class="container">

<h2>Abertura de Chamado â€“ Suporte TI</h2>

<label>VocÃª Ã©:</label>
<select id="perfil" onchange="controlePerfil()">
    <option value="">Selecione</option>
    <option>Aluno</option>
    <option>Colaborador</option>
</select>

<label>E-mail institucional:</label>
<input type="email" id="email">

<label>Unidade:</label>
<select id="unidade" onchange="controleUnidade()">
    <option value="">Selecione</option>
</select>

<div id="blocoSala">
    <label>Sala:</label>
    <div id="containerSala"></div>
</div>

<div id="camposAluno" style="display:none;">
    <label>Turma:</label>
    <input id="turmaAluno">
</div>

<div id="camposColaborador" style="display:none;">
    <label>Setor:</label>
    <select id="setor"></select>
</div>

<label>Equipamento / SolicitaÃ§Ã£o:</label>
<select id="equipamento"></select>

<label>DescriÃ§Ã£o detalhada do problema (opcional):</label>
<textarea id="descricao" rows="4"></textarea>

<button type="button" onclick="gerarRevisao()">Revisar Chamado</button>

<div class="review" id="revisao">
    <h3>RevisÃ£o do Chamado</h3>
    <pre id="resumo"></pre>
    <button type="button" onclick="enviarEmail()">Confirmar e Abrir Chamado</button>
</div>

</div>

<script>
const unidades = [
    "Head Office Brazil","Os Batutinhas","ColÃ©gio Leonardo Da Vinci","Eleva Botafogo",
    "Eleva Urca","Eleva Barra da Tijuca","Eleva Recife","Eleva BrasÃ­lia","Eleva SÃ£o Paulo",
    "GurilÃ¢ndia FederaÃ§Ã£o","GurilÃ¢ndia Pituba","Land School FederaÃ§Ã£o","Land School Pituba"
];

const equipamentosAluno = [
    "Computador","Chromebook","iPad","Internet","Carregador","Headset","Outro"
];

const equipamentosColaboradorBase = [
    "Mouse","Teclado","Kit Mouse + Teclado",
    "Monitor","Impressora","Internet / Rede",
    "Pacote Office","Programa especÃ­fico para o setor"
];

const equipamentosExtras = [
    "Computador","Chromebook","Projetor","Som",
    "iPad","Impressora","Internet","Carregador",
    "Telefone","Headset","Outro"
];

const salasRestritasAluno = [
    "Sala do Head Master",
    "Sala da CoordenaÃ§Ã£o",
    "Sala da CoordenaÃ§Ã£o do Infantil",
    "Sala dos Professores",
    "Sala dos Professores - Mezanino",
    "RecepÃ§Ã£o do Infantil",
    "RecepÃ§Ã£o Principal",
    "BirÃ´",
    "Enfermaria"
];

function gerar(prefixo, ini, fim) {
    return Array.from({length:fim-ini+1},(_,i)=>prefixo+String(ini+i).padStart(2,"0"));
}

function salasPorUnidade(unidade) {

    if (unidade === "Eleva Botafogo") return [
        "AuditÃ³rio Multiuso","AuditÃ³rio Vermelho",
        "Biblioteca Infantil","Biblioteca Principal",
        "BirÃ´","Enfermaria","Maker Space",
        "RecepÃ§Ã£o do Infantil","RecepÃ§Ã£o Principal",
        "Sala de Artes - PrÃ©dio Anexo",
        "Sala de MÃºsica - Infantil",
        "Sala de MÃºsica - Mezanino",
        "Sala de MÃºsica - PrÃ©dio Anexo",
        "Sala do Head Master",
        "Sala da CoordenaÃ§Ã£o",
        "Sala da CoordenaÃ§Ã£o do Infantil",
        "Sala dos Professores",
        "Sala dos Professores - Mezanino",
        "LAB 01","LAB 02",
        "LAB 03 - PrÃ©dio Anexo",
        "LAB 04 - PrÃ©dio Anexo",
        ...gerar("A",1,10),
        ...gerar("B",1,36),
        ...gerar("C",1,5),
        ...gerar("D",1,10)
    ];

    if (unidade === "Eleva Urca") return [
        ...Array.from({length:12},(_,i)=>`Bloco Praia - Sala ${String(i+1).padStart(2,"0")}`),
        ...Array.from({length:9},(_,i)=>`Bloco RuÃ­nas - Sala ${String(i+12).padStart(2,"0")}`)
    ];

    if (unidade === "Eleva Recife") return [
        ...gerar("A",1,9),...gerar("B",1,22),...gerar("C",1,10),
        "EAL","LAB01","LAB02","MAKER","ARTS",
        ...gerar("D",1,13),"DANÃ‡A","MUSIC01","MUSIC02"
    ];

    if (unidade === "Eleva BrasÃ­lia") return [
        "MÃºsica","Drama","Artes",
        ...gerar("A",1,20),"Maker Space",
        ...gerar("B",1,20),"Lab QuÃ­mica","Lab FÃ­sica"
    ];

    if (unidade === "Eleva SÃ£o Paulo") return [
        "Subsolo - Sala de MÃºsica",
        ...gerar("A",1,6),...gerar("B",1,3),
        ...gerar("C",1,13),...gerar("D",1,7),
        ...gerar("E",1,5),...gerar("F",1,5)
    ];

    return null;
}

function controlePerfil() {
    unidade.innerHTML = "<option value=''>Selecione</option>";
    unidades.forEach(u => unidade.innerHTML += `<option>${u}</option>`);

    camposAluno.style.display = perfil.value==="Aluno"?"block":"none";
    camposColaborador.style.display = perfil.value==="Colaborador"?"block":"none";

    equipamento.innerHTML = "<option value=''>Selecione</option>";

    if (perfil.value==="Aluno") {
        equipamentosAluno.forEach(e=>equipamento.innerHTML+=`<option>${e}</option>`);
    } else {
        [...new Set([...equipamentosColaboradorBase, ...equipamentosExtras])]
            .forEach(e=>equipamento.innerHTML+=`<option>${e}</option>`);
    }
}

function controleUnidade() {
    containerSala.innerHTML = "";
    setor.innerHTML = "";

    if (unidade.value === "Head Office Brazil") {
        blocoSala.style.display = "none";
        [
            "AdmissÃµes","AdministraÃ§Ã£o","FinanÃ§as","JurÃ­dico","Marketing",
            "OperaÃ§Ãµes","PedagÃ³gico/ Enhancement",
            "RH - Recursos Humanos","TI - Tecnologia da InformaÃ§Ã£o"
        ].forEach(s=>setor.innerHTML+=`<option>${s}</option>`);
        return;
    }

    blocoSala.style.display = "block";

    const salas = salasPorUnidade(unidade.value);
    if (salas) {
        let listaFinal = salas;
        if (perfil.value === "Aluno") {
            listaFinal = salas.filter(s => !salasRestritasAluno.includes(s));
        }
        let html="<select id='sala'><option value=''>Selecione</option>";
        listaFinal.forEach(s=>html+=`<option>${s}</option>`);
        containerSala.innerHTML=html+"</select>";
    } else {
        containerSala.innerHTML="<input id='sala'>";
    }

    if (perfil.value==="Colaborador") {
        ["Professor","CoordenaÃ§Ã£o","OperaÃ§Ãµes","AdministraÃ§Ã£o","Diretoria","Secretaria"]
            .forEach(s=>setor.innerHTML+=`<option>${s}</option>`);
    }
}

function extrairNome(email) {
    return email.split("@")[0].replace(/[._]/g," ")
        .replace(/\b\w/g,l=>l.toUpperCase());
}

function gerarRevisao() {
    const nome = extrairNome(email.value);
    const sala = document.getElementById("sala")?.value || "N/A";

    let texto =
`Perfil: ${perfil.value}
Nome: ${nome}
E-mail: ${email.value}
Unidade: ${unidade.value}`;

    if (unidade.value !== "Head Office Brazil") texto += `\nSala: ${sala}`;
    if (perfil.value==="Aluno") texto += `\nTurma: ${turmaAluno.value || "N/A"}`;
    else texto += `\nSetor: ${setor.value || "N/A"}`;

    texto += `
Equipamento: ${equipamento.value}
DescriÃ§Ã£o:
${descricao.value || "NÃ£o informada"}`;

    resumo.textContent = texto;
    revisao.style.display="block";
}

function isMobile() {
    return /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
}

function enviarEmail() {
    const assunto = `${unidade.value} â€“ ${equipamento.value} â€“ ${extrairNome(email.value)}`;
    const corpo = encodeURIComponent(resumo.textContent);
    const destino = "it.support@inspirededu.com";

    // ðŸ“± Mobile â†’ app de e-mail
    if (isMobile()) {
        window.location.href = `mailto:${destino}?subject=${encodeURIComponent(assunto)}&body=${corpo}`;
        return;
    }

    // ðŸ’» Desktop â†’ webmail
    const emailUser = email.value.toLowerCase();

    if (perfil.value==="Aluno" || emailUser.endsWith("@escolaeleva.com.br")) {
        window.open(
            `https://mail.google.com/mail/?view=cm&to=${destino}&su=${encodeURIComponent(assunto)}&body=${corpo}`,
            "_blank"
        );
    } else {
        window.open(
            `https://outlook.office.com/mail/deeplink/compose?to=${destino}&subject=${encodeURIComponent(assunto)}&body=${corpo}`,
            "_blank"
        );
    }
}
</script>

</body>
</html>
